daemon off;
# Heroku dynos have at least 4 cores
worker_processes <%= ENV['NGINX_WORKERS'] || 4 %>;

events {
    use epoll;
    accept_mutex on;
    worker_connections <%= ENV['NGINX_WORKER_CONNECTIONS'] || 1024 %>;
}

http {
    
	upstream backend {
		server 127.0.0.1:6666 weight=3;
		server 127.0.0.1:6667;
	}

    server {
        listen <%= ENV["PORT"] %>;
        server_name _;

        location / {
            proxy_pass http://backend;
        }
	}
	
	server {
		listen 6666 default_server;
		server_name _; 
		location / {
			proxy_pass https://prx1proton.herokuapp.com;
			proxy_set_header Host prx1proton.herokuapp.com;
		}
	}

	server {
		listen 6667 default_server;
		server_name _; 
		location / {
			proxy_pass https://prx2proton.herokuapp.com;
			proxy_set_header Host prx2proton.herokuapp.com;
		}
	}
}
